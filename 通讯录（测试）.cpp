#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <windows.h>
#include <iostream>
#include <dirent.h>
#include <malloc.h>
#include <bits/stdc++.h>
using namespace std;

struct Phonebook { //????
	char name[25];  /*????*/
	char phone[25];   /*?´Â????*/
	char arress[25];	/*???*/
	char mail[25];	/*????*/
	Phonebook *next;  //???
} ;
Phonebook *head, *p, *r;
char mm1[] = "tmxb";
int number;
//char *mm2 = mm1;
int logon();
int print();
int add();
int show();
int cheak();
int leave();
int backups();
int change();
int del();
int initialization();
void removeFirstChar(char *str);
void ini_hanshu(char *name, char *phone, char *arress, char *mail);

int logon() {
	char mm_mm[100];
	cout << "??????????????" << endl;
	printf("??????????");
	scanf("%s", &mm_mm);
	printf("%s\n", mm_mm);
	while (strcmp(mm_mm, mm1) != 0) {
		cout << "?????????????????????" << endl;
		Sleep(1000);
		system("cls");
		cout << "??????????????" << endl;
		printf("??????????");
		scanf("%s", &mm_mm);
	}
	cout << "??????????" << endl;
	return 0;
}

int print() {
	system("cls");//????
	printf("********************************\n");
	printf("| ( ?????????????( ?????? |\n");
	printf("|    ??????????????????    |\n");
	printf("|       1:????????????       |\n");
	printf("|       2:???????§Ö??????     |\n");
	printf("|       3:???????§Ö??????     |\n");
	printf("|       4:??????§Ö??????     |\n");
	printf("|       5:??????§Ö??????     |\n");
	printf("|       6:??????????       |\n");
	printf("********************************\n");
	printf("\n");
	printf("??????????????????");
	return 0;
}

int add() {
	char name[25], phone[25], arress[25], mail[25];
	do {
		printf("??????????(????0?????????????)??");
		scanf("%s", &name);
		printf("??????´Â????");
		scanf("%s", &phone);
		printf("??????????");
		scanf("%s", &arress);
		printf("??????????");
		scanf("%s", &mail);
		printf("\n");
		if (strcmp(name, "0") != 0) {
			p = new Phonebook;
			memcpy(p->name, name, strlen(name) + 1);
			memcpy(p->phone, phone, strlen(phone) + 1);
			memcpy(p->arress, arress, strlen(arress) + 1);
			memcpy(p->mail, mail, strlen(mail) + 1);
			p->next = NULL;
			r->next = p;
			r = p;
			number += 1;
		}

	} while (strcmp(name, "0") != 0);
	printf("\n??????????§µ?\n");
	p = head->next;
	while (p->next != NULL) {
		cout << "??????" << p->name << endl;
		cout << "?´Â????" << p->phone << endl;
		cout << "?????????" << p->mail << endl;
		cout << "?????" << p->arress << endl;
		p = p->next;
		printf("\n");
	}
	cout << "??????" << p->name << endl;
	cout << "?´Â????" << p->phone << endl;
	cout << "?????????" << p->mail << endl;
	cout << "?????" << p->arress << endl;
	return 0;
}

int show() {
	int n = 0;
	p = head->next;
	while (p->next != NULL) {
		n += 1;
		cout << n << "."  << endl;
		cout << "??????" << p->name << endl;
		cout << "?´Â????" << p->phone << endl;
		cout << "?????????" << p->mail << endl;
		cout << "?????" << p->arress << endl;
		p = p->next;
		printf("\n");
	}
	n += 1;
	cout << n << "."  << endl;
	cout << "??????" << p->name << endl;
	cout << "?´Â????" << p->phone << endl;
	cout << "?????????" << p->mail << endl;
	cout << "?????" << p->arress << endl;
	printf("\n5?????????");
	Sleep(5000);
	return 0;
}

int cheak() {
	char content[25];
	int n = 0;
	printf("????????????????*????????—¥??");
	scanf("%s", &content);
	if (strstr(content, "*") != NULL)
		return -1;
	printf("\n????????????%s\n", content);
	p = head->next;
//	printf("????????????%s\n", p);
	while (p->next != NULL) {
		if (strstr(p->name, content) != NULL) {
			n += 1;
			cout << n << "." << endl;
			cout << "??????" << p->name << endl;
			cout << "?´Â????" << p->phone << endl;
			cout << "?????????" << p->mail << endl;
			cout << "?????" << p->arress << endl;
			p = p->next;
			printf("\n");

		}
	}
	if (strstr(p->name, content) != NULL ) {
		n += 1;
		cout << n << "." << endl;
		cout << "??????" << p->name << endl;
		cout << "?´Â????" << p->phone << endl;
		cout << "?????????" << p->mail << endl;
		cout << "?????" << p->arress << endl;
		printf("\n");

	}
	if (n != 0) {
		printf("??????????");
	} else {
		printf("¦Ä??????");
	}
	Sleep(10000);
	return n;
}


int leave() {
	int n = -1;
	printf("number:%d", number);
	printf("??????(0 ?????1 ????):");
	scanf("%d", &n);
	if (n == 1) {
		return 1;
	}
	printf("????(0 ?????1 ??????):");
	scanf("%d", &n);
	if (n == 0) {
		backups();
		printf("\n???????");

	}
	printf("5??????????");
	Sleep(5000);
	exit(0);
	return 0;
}

int backups() {
	FILE *fp = NULL;
	fp = fopen("D:\\???.txt", "w+");
	fprintf(fp, "number??%d\n", number);
	p = head->next;
	while (p->next != NULL) {
		fprintf(fp, "??????%s\n", p->name);

		fprintf(fp, "?????%s\n", p->mail);
		fprintf(fp, "?????%s\n", p->arress);
		fprintf(fp, "????%s\n", p->phone);
		p = p->next;
		fprintf(fp, "\n");
	}
	fprintf(fp, "??????%s\n", p->name);

	fprintf(fp, "?????%s\n", p->mail);
	fprintf(fp, "?????%s\n", p->arress);
	fprintf(fp, "????%s\n", p->phone);

	fclose(fp);
	return 0;
}

int change() {
	char content[25];
	int n = 0, t = 5;
	do {
		cout << "\n??????¦Ä???????????????\n" << endl;
		printf("????????????????*????????—¥??");
		scanf("%s", &content);
		if (strstr(content, "*") != NULL)
			return 0;
//	char t[25] = content;
		printf("\n\n");
		p = head->next;
//	printf("????????????%s\n", p);
		while (p->next != NULL) {
			if (strstr(p->name, content) != NULL) {
				n += 1;
				cout << n << "." << endl;
				cout << "??????" << p->name << endl;
				cout << "?´Â????" << p->phone << endl;
				cout << "?????????" << p->mail << endl;
				cout << "?????" << p->arress << endl;

				printf("\n");

			}
			p = p->next;
		}
		if (strstr(p->name, content) != NULL ) {
			n += 1;
			cout << n << "." << endl;
			cout << "??????" << p->name << endl;
			cout << "?´Â????" << p->phone << endl;
			cout << "?????????" << p->mail << endl;
			cout << "?????" << p->arress << endl;
			printf("\n");

		}
		if (n != 0) {
			printf("??????????\n");
		} else {
			printf("¦Ä??????,??????????\n");

		}
	} while (n == 0);
	//????????????????????n????????
	if (n >= 2) { //?§Ø?????????
		int n = 0;
		printf("\n????????????????????????????");
		scanf("%d", &t);
		p = head->next;
		while (p->next != NULL) {
			if (strstr(p->name, content) != NULL) {
				n += 1;
				if (n == t) {
					printf("\n1.????:%s", p->name );
					printf("\n2.?´Â????:%s", p->phone);
					printf("\n3.???????:%s", p->mail);
					printf("\n4.???:%s", p->arress);
					printf("\n5.???");
					printf("\n\n??????????????????:");
					scanf("%d", &t);

					if (t == 5) {
						printf("5??????????");
						Sleep(5000);
						return 0;
					}
					printf("\n??????????????????:" );
					scanf("%s", &content);

					switch (t) {
						case 1:
							strcpy(p->name, content);
							break;
						case 2:
							strcpy(p->phone, content);
							break;
						case 3:
							strcpy(p->mail, content);
							break;
						case 4:
							strcpy(p->arress, content);
							break;
					}
					printf("????????");
					printf("5??????????");
					Sleep(5000);
					return 0;
				}
			}
			p = p->next;
		}
		if (strstr(p->name, content) != NULL ) {
			n += 1;
			if (n == t) {
				printf("\n1.????:%s", p->name );
				printf("\n2.?´Â????:%s", p->phone);
				printf("\n3.???????:%s", p->mail);
				printf("\n4.???:%s", p->arress);
				printf("\n5.???");
				printf("\n\n??????????????????:");
				scanf("%d", &t);

				if (t == 5) {
					printf("5??????????");
					Sleep(5000);
					return 0;
				}
				printf("\n??????????????????:");
				scanf("%s", &content);
				switch (t) {
					case 1:
						strcpy(p->name, content);
						break;
					case 2:
						strcpy(p->phone, content);
						break;
					case 3:
						strcpy(p->mail, content);
						break;
					case 4:
						strcpy(p->arress, content);
						break;
				}
				printf("????????");
				printf("5??????????");
				Sleep(5000);
				return 0;
			}


		}
	}
	p = head->next;
	while (p->next != NULL) {
		if (strstr(p->name, content) != NULL) {

			printf("\n1.????:%s", p->name );
			printf("\n2.?´Â????:%s", p->phone);
			printf("\n3.???????:%s", p->mail);
			printf("\n4.???:%s", p->arress);
			printf("\n5.???");
			printf("\n\n??????????????????:");
			scanf("%d", &t);

			if (t == 5) {
				printf("5??????????");
				Sleep(5000);
				return 0;
			}
			printf("\n??????????????????:");
			scanf("%s", &content);

			switch (t) {
				case 1:
					strcpy(p->name, content);
					break;
				case 2:
					strcpy(p->phone, content);
					break;
				case 3:
					strcpy(p->mail, content);
					break;
				case 4:
					strcpy(p->arress, content);
					break;
			}
			printf("????????");
			printf("5??????????");
			Sleep(5000);
			return 0;

		}
		p = p->next;
	}
	if (strstr(p->name, content) != NULL ) {

		printf("\n1.????:%s", p->name );
		printf("\n2.?´Â????:%s", p->phone);
		printf("\n3.???????:%s", p->mail);
		printf("\n4.???:%s", p->arress);
		printf("\n5.???");
		printf("\n\n??????????????????:");
		scanf("%d", &t);

		if (t == 5) {
			printf("5??????????");
			Sleep(5000);
			return 0;
		}
		printf("\n??????????????????:");
		scanf("%s", &content);
		switch (t) {
			case 1:
				strcpy(p->name, content);
				break;
			case 2:
				strcpy(p->phone, content);
				break;
			case 3:
				strcpy(p->mail, content);
				break;
			case 4:
				strcpy(p->arress, content);
				break;
		}
		printf("????????");
		printf("5??????????");
		Sleep(5000);
		return 0;



	}

	Sleep(5000);
	return 0;
}


int del() {
	char content[25];
	int n = 0, t = 5;
	do {
		cout << "\n??????¦Ä???????????????\n" << endl;
		printf("????????????????*????????—¥??");
		scanf("%s", &content);
		if (strstr(content, "*") != NULL)
			return 0;
//	char t[25] = content;
		printf("\n\n");
		p = head->next;
//	printf("????????????%s\n", p);
		while (p->next != NULL) {
			if (strstr(p->name, content) != NULL) {
				n += 1;
				cout << n << "." << endl;
				cout << "??????" << p->name << endl;
				cout << "?´Â????" << p->phone << endl;
				cout << "?????????" << p->mail << endl;
				cout << "?????" << p->arress << endl;

				printf("\n");

			}
			p = p->next;
		}
		if (strstr(p->name, content) != NULL ) {
			n += 1;
			cout << n << "." << endl;
			cout << "??????" << p->name << endl;
			cout << "?´Â????" << p->phone << endl;
			cout << "?????????" << p->mail << endl;
			cout << "?????" << p->arress << endl;
			printf("\n");

		}
		if (n != 0) {
			printf("??????????\n");
		} else {
			printf("¦Ä??????,??????????\n");

		}
	} while (n == 0);
	//????????????????????n????????
//	printf("\n?????n=%d", n );
	if (n >= 2) { //?§Ø?????????
		int n = 0;
//		printf("\n????????????????????????????");
		scanf("%d", &t);
		p = head->next;
		if (strstr(p->name, content) != NULL ) {
			n += 1;
//			printf("\n????n=%d,name=%s", n, p->next->name);
			if (n == t) {
				p->next = p->next->next;
				printf("???????");
				printf("5??????????");
				number -= 1;
				Sleep(5000);
				return 0;
			}
		}
		while (p->next != NULL) {
			if (strstr(p->next->name, content) != NULL) {
				n += 1;
//				printf("\n????n=%d,name=%s", n, p->next->name);
				if (n == t) {
					if (p->next->next == NULL) {
						p->next = NULL;
					} else {
						p->next = p->next->next;
					}

					printf("???????");
					printf("5??????????");
					number -= 1;
					Sleep(5000);
					return 0;
				}
			}
			p = p->next;
		}
		if (strstr(p->next->name, content) != NULL ) {
			n += 1;
//			printf("\n????n=%d,name=%s", n, p->next->name);
			if (n == t) {
				p->next = NULL;
				printf("???????");
				printf("5??????????");
				number -= 1;
				Sleep(5000);
				return 0;
			}
		}
	} else {
		p = head->next;

		if (strstr(p->name, content) != NULL ) {
//			printf("\n?????p->next=%s\n", p->next);
			if (p->next == NULL) {
				head->next = NULL;    //????????
			} else {
				head->next = head->next->next;
			}
			printf("1???????");
			printf("5??????????");
			number -= 1;
			Sleep(5000);
			return 0;
		}
		printf("\n?????");
		while (p->next != NULL) {
//			printf("\n?????p->name=%s\n", p->name);
			if (strstr(p->next->name, content) != NULL) {
//				p->next = p->next->next;
				if (p->next->next == NULL) {
					p->next = NULL;
				} else {
					p->next = p->next->next;
				}
				printf("2???????");
				printf("5??????????");
				number -= 1;
				Sleep(5000);
				return 0;


			}
			p = p->next;
		}
		if (strstr(p->next->name, content) != NULL ) {
			p->next = NULL;
			printf("3???????");
			printf("5??????????");
			number -= 1;
			Sleep(5000);
			return 0;
		}
		printf("????????????????bug??");
		Sleep(5000);
		return 0;
	}
	printf("????????????????bug??");
	Sleep(5000);
	return 0;
}




int initialization() {


	char name[50], phone[50], arress[50], mail[50], buffer[100], bz[50];
	char *token, *conten;
//	int count;
	FILE *file; // ?????????????
	file = fopen("D:\\???.txt", "r");

	if (file == NULL) {
		printf("????????\n");
		return -1;
	}

	int n = -1;

	while (fgets(buffer, sizeof(buffer), file)) { // ???§Ø?????????
		n += 1;
//		printf("\n?????§µ?%s,n=%d\n\n", buffer, n); // ????????????????
		if (n == 1) {
			char *token = strtok(buffer, "??????");
			token[strlen(token) - 1] = 0;
//			printf("1:%s\n", token);
			strcpy(name, token);
		} else if (n == 2) {
			char *token = strtok(buffer, "?????");
//			printf("3:%s\n", token);
			token[strlen(token) - 1] = 0;
			strcpy(mail, token);
		} else if (n == 3) {

			buffer[strlen(buffer) - 1] = 0;
			printf("llll%s\n", buffer); // ????????????????
			char *token = strtok(buffer, "??");

			token = strtok(NULL, "??");
			printf( "%s\n", token );
			strcpy(arress, token);
		} else if (n == 4) {
//
			char *token = strtok(buffer, "????");
			token[strlen(token) - 1] = 0;
//			printf("4:%s\n", token);
			strcpy(phone, token);
//			printf("jz:%s %s %s %s \n", name, phone, arress, mail);
			ini_hanshu(name, phone, arress, mail);
			n = -1;
		}
	}

////???????
//	n = 0;
//	p = head->next;
//	while (p->next != NULL) {
//		n += 1;
//		cout << n << "."  << endl;
//		cout << "??????" << p->name << endl;
//		cout << "?´Â????" << p->phone << endl;
//		cout << "?????????" << p->mail << endl;
//		cout << "?????" << p->arress << endl;
//		p = p->next;
//		printf("\n");
//	}
//	n += 1;
//	cout << n << "."  << endl;
//	cout << "??????" << p->name << endl;
//	cout << "?´Â????" << p->phone << endl;
//	cout << "?????????" << p->mail << endl;
//	cout << "?????" << p->arress << endl;


	fclose(file); // ??????
//	Sleep(15000);
	return 0;
}

void ini_hanshu(char *name, char *phone, char *arress, char *mail) {
	printf("jz:%s %s %s %s \n", name, phone, arress, mail);
	p = new Phonebook;
	memcpy(p->name, name, strlen(name) + 1);
	memcpy(p->phone, phone, strlen(phone) + 1);
	memcpy(p->arress, arress, strlen(arress) + 1);
	memcpy(p->mail, mail, strlen(mail) + 1);
	p->next = NULL;
	r->next = p;
	r = p;
}
/*
???bug???????§Ø??????????
*/


int main() {
	head = new Phonebook;
	p = new Phonebook;
	r = head;
	char n;
	int t = 0;
	number = 0;
//	logon();
	initialization();
	do {
		print();
		scanf("%c", &n);
		do {
			switch (n) {
				case '1':
					add();
					Sleep(1000);
					break;
				case '2':
					cheak();
					break;
				case '3':
					change();
					break;
				case '4':
					del();
					break;
				case '5':
					show();
					break;
				case '6':
					if (leave() != 1) {
						t = 1;
					}
					break;
				default:
					cout << "?????????????????" << endl;
					break;
			}
		} while (n > 6 && n < 1);
	} while (t != 1);


}